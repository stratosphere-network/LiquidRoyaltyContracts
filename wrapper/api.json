{
  "openapi": "3.0.3",
  "info": {
    "title": "LiquidRoyalty Vault API",
    "description": "REST API for interacting with Senior, Junior, and Reserve vaults on Polygon, including Uniswap V2 pool operations, token swaps, liquidity provision, and vault staking",
    "version": "1.0.0",
    "contact": {
      "name": "LiquidRoyalty",
      "url": "https://liquidroyalty.io"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Local development server"
    },
    {
      "url": "https://api.liquidroyalty.io",
      "description": "Production server"
    }
  ],
  "tags": [
    {
      "name": "Health",
      "description": "Health check endpoints"
    },
    {
      "name": "Uniswap Pool",
      "description": "Uniswap V2 pool information and operations"
    },
    {
      "name": "Vaults",
      "description": "Vault information and analytics"
    },
    {
      "name": "Trading",
      "description": "Token swaps and liquidity operations"
    },
    {
      "name": "Staking",
      "description": "Vault staking operations"
    },
    {
      "name": "Admin",
      "description": "Admin-only operations for vault management"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Health check",
        "description": "Check if the API is running and responsive",
        "operationId": "healthCheck",
        "responses": {
          "200": {
            "description": "API is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time",
                      "example": "2025-11-05T10:30:00.000Z"
                    },
                    "uptime": {
                      "type": "number",
                      "description": "Server uptime in seconds",
                      "example": 3600.5
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/pair": {
      "get": {
        "tags": ["Uniswap Pool"],
        "summary": "Get Uniswap V2 LP pair address",
        "description": "Returns the address of the TUSD-TSAIL Uniswap V2 LP pair on Polygon",
        "operationId": "getPairAddress",
        "responses": {
          "200": {
            "description": "LP pair address retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "pairAddress": {
                      "type": "string",
                      "description": "Address of the TUSD-TSAIL LP pair",
                      "example": "0x2cd6179f1cb01636b7f497f13ea5b2fa1cedcc68"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/reserves": {
      "get": {
        "tags": ["Uniswap Pool"],
        "summary": "Get pool reserves",
        "description": "Fetch the current reserves of TUSD and TSAIL in the Uniswap V2 pool",
        "operationId": "getReserves",
        "responses": {
          "200": {
            "description": "Pool reserves retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token0": {
                          "type": "string",
                          "description": "Address of token0 in the pair",
                          "example": "0x3ee4686e8165d1358f67b6635f62fb8ca6ac0b08"
                        },
                        "token1": {
                          "type": "string",
                          "description": "Address of token1 in the pair",
                          "example": "0xeddc540d74155791c9d43c95eb635c1b52fe0a6d"
                        },
                        "reserve0": {
                          "type": "string",
                          "description": "Reserve of token0 (formatted)",
                          "example": "564703.785903822213228733"
                        },
                        "reserve1": {
                          "type": "string",
                          "description": "Reserve of token1 (formatted)",
                          "example": "5024424.839891044321090688"
                        },
                        "tsailReserve": {
                          "type": "string",
                          "description": "TSAIL reserve (formatted)",
                          "example": "564703.785903822213228733"
                        },
                        "tusdReserve": {
                          "type": "string",
                          "description": "TUSD reserve (formatted)",
                          "example": "5024424.839891044321090688"
                        },
                        "blockTimestampLast": {
                          "type": "integer",
                          "description": "Last block timestamp",
                          "example": 1762271343
                        },
                        "raw": {
                          "type": "object",
                          "properties": {
                            "reserve0": {
                              "type": "string",
                              "description": "Reserve0 in wei",
                              "example": "564703785903822213228733"
                            },
                            "reserve1": {
                              "type": "string",
                              "description": "Reserve1 in wei",
                              "example": "5024424839891044321090688"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/lp-price": {
      "get": {
        "tags": ["Uniswap Pool"],
        "summary": "Get LP token price",
        "description": "Calculate the current price of one LP token in TUSD based on pool reserves",
        "operationId": "getLPPrice",
        "responses": {
          "200": {
            "description": "LP token price calculated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "lpTokenPrice": {
                          "type": "string",
                          "description": "Price of 1 LP token in TUSD",
                          "example": "6.355451"
                        },
                        "lpTokenPriceInTUSD": {
                          "type": "string",
                          "description": "Price of 1 LP token in TUSD (alias)",
                          "example": "6.355451"
                        },
                        "totalSupply": {
                          "type": "string",
                          "description": "Total LP token supply",
                          "example": "1234567.890123"
                        },
                        "totalPoolValue": {
                          "type": "string",
                          "description": "Total value of the pool in TUSD",
                          "example": "7846390.123456"
                        },
                        "tsailPrice": {
                          "type": "string",
                          "description": "Price of TSAIL in TUSD",
                          "example": "8.900123"
                        },
                        "reserves": {
                          "type": "object",
                          "properties": {
                            "tsail": {
                              "type": "string",
                              "example": "564703.785904"
                            },
                            "tusd": {
                              "type": "string",
                              "example": "5024424.839891"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/vaults/total-supply": {
      "get": {
        "tags": ["Vaults"],
        "summary": "Get vaults total supply",
        "description": "Fetch the total supply of shares for Senior, Junior, and Reserve vaults",
        "operationId": "getVaultsTotalSupply",
        "responses": {
          "200": {
            "description": "Vaults total supply retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/VaultsTotalSupply"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/vaults/value": {
      "get": {
        "tags": ["Vaults"],
        "summary": "Get vaults value in USD",
        "description": "Calculate the USD value of each vault based on totalAssets * LP token price",
        "operationId": "getVaultsValue",
        "responses": {
          "200": {
            "description": "Vaults USD value calculated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/VaultsValueUSD"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/senior/backing-ratio": {
      "get": {
        "tags": ["Vaults"],
        "summary": "Get senior backing ratio",
        "description": "Calculate the Senior vault backing ratio: (valueUSD / totalSupply) + 100",
        "operationId": "getSeniorBackingRatio",
        "responses": {
          "200": {
            "description": "Senior backing ratio calculated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "seniorVault": {
                          "type": "object",
                          "properties": {
                            "address": {
                              "type": "string",
                              "example": "0x0b0d6b5d6656504c826ad34bd56ae683efc94395"
                            },
                            "totalSupply": {
                              "type": "string",
                              "example": "79113.924050"
                            },
                            "totalAssets": {
                              "type": "string",
                              "example": "500000.000000"
                            },
                            "valueUSD": {
                              "type": "string",
                              "example": "3177725.50"
                            },
                            "backingRatio": {
                              "type": "string",
                              "description": "Backing ratio as percentage",
                              "example": "140.16%"
                            }
                          }
                        },
                        "lpTokenPrice": {
                          "type": "string",
                          "example": "6.355451"
                        },
                        "backingRatioRaw": {
                          "type": "string",
                          "description": "Raw backing ratio value",
                          "example": "140.164503"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/vaults/onchain-value": {
      "get": {
        "tags": ["Vaults"],
        "summary": "Get vaults on-chain reported value",
        "description": "Fetch the on-chain reported vaultValue() for all three vaults",
        "operationId": "getVaultsOnChainValue",
        "responses": {
          "200": {
            "description": "On-chain vault values retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/VaultsOnChainValue"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/vaults/profits": {
      "get": {
        "tags": ["Vaults"],
        "summary": "Get vaults profits",
        "description": "Calculate vault profits as percentage: ((currentUSD - onChainValue) / onChainValue) * 100",
        "operationId": "getVaultsProfits",
        "responses": {
          "200": {
            "description": "Vaults profits calculated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/VaultsProfits"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/junior/token-price": {
      "get": {
        "tags": ["Vaults"],
        "summary": "Get Junior token price",
        "description": "Calculate the Junior token price: (Total LP in Junior × LP Price) / Total Supply of Junior",
        "operationId": "getJuniorTokenPrice",
        "responses": {
          "200": {
            "description": "Junior token price calculated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "juniorVault": {
                          "type": "object",
                          "properties": {
                            "address": {
                              "type": "string",
                              "example": "0x210603159a8f18e820e44c390b7046d507ee7fb5"
                            },
                            "totalSupply": {
                              "type": "string",
                              "example": "50000.000000"
                            },
                            "totalAssets": {
                              "type": "string",
                              "example": "50000.000000"
                            },
                            "valueUSD": {
                              "type": "string",
                              "example": "317772.55"
                            },
                            "tokenPrice": {
                              "type": "string",
                              "description": "Price per Junior token in TUSD",
                              "example": "6.355451"
                            }
                          }
                        },
                        "lpTokenPrice": {
                          "type": "string",
                          "example": "6.355451"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/swap": {
      "post": {
        "tags": ["Trading"],
        "summary": "Swap tokens",
        "description": "Swap between TUSD and TSAIL tokens on Uniswap V2. Automatically checks balance, handles approvals, and applies slippage protection",
        "operationId": "swapTokens",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SwapRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token swap executed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "transactionHash": {
                      "type": "string",
                      "example": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
                    },
                    "from": {
                      "type": "string",
                      "description": "Address that executed the swap",
                      "example": "0xE09883Cb3Fe2d973cEfE4BB28E3A3849E7e5f0A7"
                    },
                    "swap": {
                      "type": "object",
                      "properties": {
                        "tokenIn": {
                          "type": "string",
                          "example": "TUSD"
                        },
                        "tokenOut": {
                          "type": "string",
                          "example": "TSAIL"
                        },
                        "amountIn": {
                          "type": "string",
                          "example": "1000"
                        },
                        "amountOutExpected": {
                          "type": "string",
                          "example": "112.345678901234567890"
                        },
                        "amountOutMin": {
                          "type": "string",
                          "example": "111.783950556777777777"
                        },
                        "slippage": {
                          "type": "string",
                          "example": "0.5%"
                        }
                      }
                    },
                    "blockNumber": {
                      "type": "integer",
                      "example": 78620000
                    },
                    "gasUsed": {
                      "type": "string",
                      "example": "150000"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Missing required parameters: privateKey, tokenIn, amountIn"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/add-liquidity": {
      "post": {
        "tags": ["Trading"],
        "summary": "Add liquidity to pool",
        "description": "Add liquidity to the TUSD-TSAIL Uniswap V2 pool. Automatically calculates optimal ratio, checks balances, handles approvals, and applies slippage protection",
        "operationId": "addLiquidity",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddLiquidityRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Liquidity added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "transactionHash": {
                      "type": "string",
                      "example": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
                    },
                    "from": {
                      "type": "string",
                      "example": "0xE09883Cb3Fe2d973cEfE4BB28E3A3849E7e5f0A7"
                    },
                    "liquidity": {
                      "type": "object",
                      "properties": {
                        "tusdAmount": {
                          "type": "string",
                          "example": "5000.000000000000000000"
                        },
                        "tsailAmount": {
                          "type": "string",
                          "example": "561.234567890123456789"
                        },
                        "tusdMin": {
                          "type": "string",
                          "example": "4875.000000000000000000"
                        },
                        "tsailMin": {
                          "type": "string",
                          "example": "547.203333333333333333"
                        },
                        "slippage": {
                          "type": "string",
                          "example": "0.5%"
                        }
                      }
                    },
                    "blockNumber": {
                      "type": "integer",
                      "example": 78620000
                    },
                    "gasUsed": {
                      "type": "string",
                      "example": "200000"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Missing required parameters: privateKey, amountTUSD, amountTSAIL"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/zap-and-stake": {
      "post": {
        "tags": ["Staking"],
        "summary": "Zap and stake in vault",
        "description": "One-click staking: User sends TUSD → Admin swaps half to TSAIL → Adds liquidity → Deposits LP tokens to vault → User receives vault shares. Handles all balance checks, approvals, and optimal ratio calculations automatically",
        "operationId": "zapAndStake",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ZapAndStakeRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Zap and stake completed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "steps": {
                      "type": "object",
                      "properties": {
                        "transfer": {
                          "type": "object",
                          "properties": {
                            "from": {
                              "type": "string",
                              "example": "0xUserAddress"
                            },
                            "to": {
                              "type": "string",
                              "example": "0xE09883Cb3Fe2d973cEfE4BB28E3A3849E7e5f0A7"
                            },
                            "amount": {
                              "type": "string",
                              "example": "10000"
                            },
                            "transactionHash": {
                              "type": "string",
                              "example": "0x123..."
                            },
                            "skipped": {
                              "type": "boolean",
                              "description": "True if user is admin (no transfer needed)"
                            },
                            "reason": {
                              "type": "string",
                              "example": "User is admin"
                            }
                          }
                        },
                        "swap": {
                          "type": "object",
                          "properties": {
                            "tusdIn": {
                              "type": "string",
                              "example": "5000.000000000000000000"
                            },
                            "tsailOut": {
                              "type": "string",
                              "example": "561.234567890123456789"
                            }
                          }
                        },
                        "liquidity": {
                          "type": "object",
                          "properties": {
                            "tusdAmount": {
                              "type": "string",
                              "example": "5000.000000000000000000"
                            },
                            "tsailAmount": {
                              "type": "string",
                              "example": "561.234567890123456789"
                            },
                            "lpTokens": {
                              "type": "string",
                              "example": "1677.345678901234567890"
                            }
                          }
                        },
                        "vault": {
                          "type": "object",
                          "properties": {
                            "type": {
                              "type": "string",
                              "enum": ["junior", "senior", "reserve"],
                              "example": "junior"
                            },
                            "address": {
                              "type": "string",
                              "example": "0x210603159a8f18e820e44c390b7046d507ee7fb5"
                            },
                            "recipient": {
                              "type": "string",
                              "description": "User's address (receives vault shares)",
                              "example": "0xUserAddress"
                            },
                            "lpDeposited": {
                              "type": "string",
                              "example": "1677.345678901234567890"
                            },
                            "transactionHash": {
                              "type": "string",
                              "example": "0xFinalTxHash"
                            }
                          }
                        }
                      }
                    },
                    "totalTUSDUsed": {
                      "type": "string",
                      "example": "10000"
                    },
                    "finalTransactionHash": {
                      "type": "string",
                      "description": "Final transaction hash (vault deposit)",
                      "example": "0xFinalTxHash"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Missing required parameters: privateKey, amountTUSD, vaultType (junior/senior/reserve)"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/rebase/config": {
      "get": {
        "tags": ["Admin"],
        "summary": "Get rebase configuration",
        "description": "Fetch the current rebase configuration including minimum rebase interval and last rebase time for the Senior Vault",
        "operationId": "getRebaseConfig",
        "responses": {
          "200": {
            "description": "Rebase configuration retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "minRebaseInterval": {
                          "type": "string",
                          "description": "Minimum time between rebases in seconds",
                          "example": "30"
                        },
                        "lastRebaseTime": {
                          "type": "string",
                          "description": "Unix timestamp of last rebase",
                          "example": "1762271343"
                        },
                        "canRebaseAt": {
                          "type": "string",
                          "description": "Unix timestamp when next rebase is allowed",
                          "example": "1762271373"
                        },
                        "currentTime": {
                          "type": "string",
                          "description": "Current blockchain timestamp",
                          "example": "1762271350"
                        },
                        "canRebaseNow": {
                          "type": "boolean",
                          "description": "Whether rebase can be executed now",
                          "example": false
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/rebase/set-interval": {
      "post": {
        "tags": ["Admin"],
        "summary": "Set rebase interval",
        "description": "Update the minimum rebase interval for the Senior Vault (admin only)",
        "operationId": "setRebaseInterval",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["privateKey", "intervalSeconds"],
                "properties": {
                  "privateKey": {
                    "type": "string",
                    "description": "Admin's private key (with 0x prefix)",
                    "example": "0x56f68e21f8d5809e1b17414a49b801b0caa1a482db3d4b2f16d2117a53140099"
                  },
                  "intervalSeconds": {
                    "type": "number",
                    "description": "New minimum rebase interval in seconds",
                    "minimum": 0,
                    "example": 60
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rebase interval updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "transactionHash": {
                      "type": "string",
                      "example": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
                    },
                    "oldInterval": {
                      "type": "string",
                      "example": "30"
                    },
                    "newInterval": {
                      "type": "string",
                      "example": "60"
                    },
                    "blockNumber": {
                      "type": "integer",
                      "example": 78620000
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "intervalSeconds must be a number"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/vault/update-value": {
      "post": {
        "tags": ["Admin"],
        "summary": "Update vault value",
        "description": "Update the Senior Vault's on-chain value based on off-chain calculation. Automatically splits large updates into multiple transactions if profitBps exceeds +100% (10000 BPS). Accepts profit/loss in basis points (-5000 to +10000 per update, representing -50% to +100%)",
        "operationId": "updateVaultValue",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["privateKey", "profitBps"],
                "properties": {
                  "privateKey": {
                    "type": "string",
                    "description": "Admin's private key (with 0x prefix)",
                    "example": "0x56f68e21f8d5809e1b17414a49b801b0caa1a482db3d4b2f16d2117a53140099"
                  },
                  "profitBps": {
                    "type": "number",
                    "description": "Profit in basis points (100 BPS = 1%). Range: -5000 to +10000 per update. Values >10000 are automatically split into multiple transactions.",
                    "minimum": -5000,
                    "example": 500
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Vault value updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "transactionHash": {
                      "type": "string",
                      "description": "Transaction hash (only for single updates)",
                      "example": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
                    },
                    "multipleUpdates": {
                      "type": "boolean",
                      "description": "True if update was split into multiple transactions",
                      "example": false
                    },
                    "totalUpdates": {
                      "type": "integer",
                      "description": "Number of transactions sent (only for multiple updates)",
                      "example": 3
                    },
                    "transactions": {
                      "type": "array",
                      "description": "Array of transaction details (only for multiple updates)",
                      "items": {
                        "type": "object",
                        "properties": {
                          "step": {
                            "type": "integer",
                            "example": 1
                          },
                          "bps": {
                            "type": "integer",
                            "example": 10000
                          },
                          "txHash": {
                            "type": "string",
                            "example": "0xabc..."
                          },
                          "newValue": {
                            "type": "string",
                            "example": "100000.00"
                          }
                        }
                      }
                    },
                    "profitBps": {
                      "type": "integer",
                      "description": "Profit BPS applied (single update)",
                      "example": 500
                    },
                    "profitBpsTotal": {
                      "type": "integer",
                      "description": "Total profit BPS applied (multiple updates)",
                      "example": 25000
                    },
                    "profitPercent": {
                      "type": "string",
                      "description": "Profit as percentage with % sign",
                      "example": "+5.00%"
                    },
                    "oldValue": {
                      "type": "string",
                      "description": "Previous vault value in TUSD",
                      "example": "100000.00"
                    },
                    "newValue": {
                      "type": "string",
                      "description": "New vault value in TUSD",
                      "example": "105000.00"
                    },
                    "blockNumber": {
                      "type": "integer",
                      "example": 78620000
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "profitBps must be a number (basis points: -5000 to +10000)"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/vault/rebase": {
      "post": {
        "tags": ["Admin"],
        "summary": "Execute rebase",
        "description": "Execute the rebase function on the Senior Vault. Adjusts token supply based on profit/loss, deducts management and performance fees, and handles spillover/backstop with Junior and Reserve vaults. Can only be called after minRebaseInterval has passed since last rebase.",
        "operationId": "executeRebase",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["privateKey"],
                "properties": {
                  "privateKey": {
                    "type": "string",
                    "description": "Admin's private key (with 0x prefix)",
                    "example": "0x56f68e21f8d5809e1b17414a49b801b0caa1a482db3d4b2f16d2117a53140099"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rebase executed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "transactionHash": {
                      "type": "string",
                      "example": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
                    },
                    "before": {
                      "type": "object",
                      "properties": {
                        "totalSupply": {
                          "type": "string",
                          "example": "79113.924050"
                        },
                        "vaultValue": {
                          "type": "string",
                          "example": "3000000.00"
                        },
                        "lastRebaseTime": {
                          "type": "string",
                          "example": "1762271343"
                        }
                      }
                    },
                    "after": {
                      "type": "object",
                      "properties": {
                        "totalSupply": {
                          "type": "string",
                          "example": "79500.123456"
                        },
                        "vaultValue": {
                          "type": "string",
                          "example": "3000000.00"
                        },
                        "lastRebaseTime": {
                          "type": "string",
                          "example": "1762271400"
                        },
                        "supplyChange": {
                          "type": "string",
                          "description": "Change in supply with sign",
                          "example": "+386.199406"
                        }
                      }
                    },
                    "blockNumber": {
                      "type": "integer",
                      "example": 78620000
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request or rebase not allowed yet",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "Rebase too soon. Min interval: 30s, time since last: 15s"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    },
    "/vault/whitelist": {
      "post": {
        "tags": ["Admin"],
        "summary": "Whitelist address for Senior Vault",
        "description": "Add an address to the Senior Vault's whitelist. Only whitelisted addresses can deposit directly into the Senior Vault. Note: The zap-and-stake endpoint uses the admin address for deposits, so users don't need to be whitelisted to use that endpoint.",
        "operationId": "whitelistAddress",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["privateKey", "address"],
                "properties": {
                  "privateKey": {
                    "type": "string",
                    "description": "Admin's private key (with 0x prefix)",
                    "example": "0x56f68e21f8d5809e1b17414a49b801b0caa1a482db3d4b2f16d2117a53140099"
                  },
                  "address": {
                    "type": "string",
                    "description": "Ethereum address to whitelist (with 0x prefix)",
                    "example": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb7"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Address whitelisted successfully or already whitelisted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "alreadyWhitelisted": {
                      "type": "boolean",
                      "description": "True if address was already whitelisted",
                      "example": false
                    },
                    "transactionHash": {
                      "type": "string",
                      "description": "Transaction hash (not present if already whitelisted)",
                      "example": "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
                    },
                    "address": {
                      "type": "string",
                      "description": "Address that was whitelisted",
                      "example": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb7"
                    },
                    "message": {
                      "type": "string",
                      "description": "Status message (only if already whitelisted)",
                      "example": "Address is already whitelisted"
                    },
                    "blockNumber": {
                      "type": "integer",
                      "example": 78620000
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request parameters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "address is required"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "$ref": "#/components/responses/ErrorResponse"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SwapRequest": {
        "type": "object",
        "required": ["privateKey", "tokenIn", "amountIn"],
        "properties": {
          "privateKey": {
            "type": "string",
            "description": "Private key of the wallet (with 0x prefix)",
            "example": "0x56f68e21f8d5809e1b17414a49b801b0caa1a482db3d4b2f16d2117a53140099"
          },
          "tokenIn": {
            "type": "string",
            "enum": ["TUSD", "TSAIL"],
            "description": "Token to swap from",
            "example": "TUSD"
          },
          "amountIn": {
            "type": "string",
            "description": "Amount to swap (in token units, not wei)",
            "example": "1000"
          },
          "slippageTolerance": {
            "type": "number",
            "description": "Slippage tolerance percentage (default: 0.5)",
            "minimum": 0,
            "maximum": 100,
            "example": 0.5
          }
        }
      },
      "AddLiquidityRequest": {
        "type": "object",
        "required": ["privateKey", "amountTUSD", "amountTSAIL"],
        "properties": {
          "privateKey": {
            "type": "string",
            "description": "Private key of the wallet (with 0x prefix)",
            "example": "0x56f68e21f8d5809e1b17414a49b801b0caa1a482db3d4b2f16d2117a53140099"
          },
          "amountTUSD": {
            "type": "string",
            "description": "Desired amount of TUSD to add",
            "example": "5000"
          },
          "amountTSAIL": {
            "type": "string",
            "description": "Desired amount of TSAIL to add",
            "example": "561.234567890123456789"
          },
          "slippageTolerance": {
            "type": "number",
            "description": "Slippage tolerance percentage (default: 0.5)",
            "minimum": 0,
            "maximum": 100,
            "example": 0.5
          }
        }
      },
      "ZapAndStakeRequest": {
        "type": "object",
        "required": ["privateKey", "amountTUSD", "vaultType"],
        "properties": {
          "privateKey": {
            "type": "string",
            "description": "User's private key (with 0x prefix) - used to transfer TUSD to admin",
            "example": "0x56f68e21f8d5809e1b17414a49b801b0caa1a482db3d4b2f16d2117a53140099"
          },
          "amountTUSD": {
            "type": "string",
            "description": "Total TUSD amount to stake (will be split 50/50 for TUSD-TSAIL LP)",
            "example": "10000"
          },
          "vaultType": {
            "type": "string",
            "enum": ["junior", "senior", "reserve"],
            "description": "Vault to stake in",
            "example": "junior"
          },
          "slippageTolerance": {
            "type": "number",
            "description": "Slippage tolerance percentage (default: 0.5)",
            "minimum": 0,
            "maximum": 100,
            "example": 0.5
          }
        }
      },
      "VaultsTotalSupply": {
        "type": "object",
        "properties": {
          "seniorVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x0b0d6b5d6656504c826ad34bd56ae683efc94395"
              },
              "totalSupply": {
                "type": "string",
                "example": "79113.924050"
              },
              "totalSupplyRaw": {
                "type": "string",
                "example": "79113924050000000000000"
              }
            }
          },
          "juniorVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x210603159a8f18e820e44c390b7046d507ee7fb5"
              },
              "totalSupply": {
                "type": "string",
                "example": "50000.000000"
              },
              "totalSupplyRaw": {
                "type": "string",
                "example": "50000000000000000000000"
              }
            }
          },
          "reserveVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x7a6e684176d94863fd9e9e48673ed3a8f94265b9"
              },
              "totalSupply": {
                "type": "string",
                "example": "10000.000000"
              },
              "totalSupplyRaw": {
                "type": "string",
                "example": "10000000000000000000000"
              }
            }
          },
          "total": {
            "type": "object",
            "properties": {
              "formatted": {
                "type": "string",
                "example": "139113.924050"
              }
            }
          }
        }
      },
      "VaultsValueUSD": {
        "type": "object",
        "properties": {
          "lpTokenPrice": {
            "type": "string",
            "example": "6.355451"
          },
          "seniorVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x0b0d6b5d6656504c826ad34bd56ae683efc94395"
              },
              "totalAssets": {
                "type": "string",
                "description": "Total LP tokens in vault",
                "example": "500000.000000"
              },
              "valueUSD": {
                "type": "string",
                "description": "USD value (totalAssets * LP price)",
                "example": "3177725.50"
              },
              "totalAssetsRaw": {
                "type": "string",
                "example": "500000000000000000000000"
              }
            }
          },
          "juniorVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x210603159a8f18e820e44c390b7046d507ee7fb5"
              },
              "totalAssets": {
                "type": "string",
                "example": "50000.000000"
              },
              "valueUSD": {
                "type": "string",
                "example": "317772.55"
              },
              "totalAssetsRaw": {
                "type": "string",
                "example": "50000000000000000000000"
              }
            }
          },
          "reserveVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x7a6e684176d94863fd9e9e48673ed3a8f94265b9"
              },
              "totalAssets": {
                "type": "string",
                "example": "10000.000000"
              },
              "valueUSD": {
                "type": "string",
                "example": "63554.51"
              },
              "totalAssetsRaw": {
                "type": "string",
                "example": "10000000000000000000000"
              }
            }
          },
          "total": {
            "type": "object",
            "properties": {
              "totalAssets": {
                "type": "string",
                "example": "560000.000000"
              },
              "valueUSD": {
                "type": "string",
                "example": "3559052.56"
              }
            }
          }
        }
      },
      "VaultsOnChainValue": {
        "type": "object",
        "properties": {
          "seniorVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x0b0d6b5d6656504c826ad34bd56ae683efc94395"
              },
              "vaultValue": {
                "type": "string",
                "description": "On-chain reported vault value",
                "example": "3000000.000000"
              },
              "vaultValueRaw": {
                "type": "string",
                "example": "3000000000000000000000000"
              }
            }
          },
          "juniorVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x210603159a8f18e820e44c390b7046d507ee7fb5"
              },
              "vaultValue": {
                "type": "string",
                "example": "300000.000000"
              },
              "vaultValueRaw": {
                "type": "string",
                "example": "300000000000000000000000"
              }
            }
          },
          "reserveVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x7a6e684176d94863fd9e9e48673ed3a8f94265b9"
              },
              "vaultValue": {
                "type": "string",
                "example": "60000.000000"
              },
              "vaultValueRaw": {
                "type": "string",
                "example": "60000000000000000000000"
              }
            }
          },
          "total": {
            "type": "object",
            "properties": {
              "vaultValue": {
                "type": "string",
                "example": "3360000.000000"
              }
            }
          }
        }
      },
      "VaultsProfits": {
        "type": "object",
        "properties": {
          "lpTokenPrice": {
            "type": "string",
            "example": "6.355451"
          },
          "seniorVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x0b0d6b5d6656504c826ad34bd56ae683efc94395"
              },
              "currentValueUSD": {
                "type": "string",
                "description": "Current USD value (from totalAssets)",
                "example": "3177725.50"
              },
              "onChainValue": {
                "type": "string",
                "description": "On-chain reported value",
                "example": "3000000.00"
              },
              "profit": {
                "type": "string",
                "description": "Profit percentage with sign",
                "example": "+5.92%"
              },
              "profitRaw": {
                "type": "string",
                "description": "Raw profit percentage",
                "example": "5.924183"
              }
            }
          },
          "juniorVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x210603159a8f18e820e44c390b7046d507ee7fb5"
              },
              "currentValueUSD": {
                "type": "string",
                "example": "317772.55"
              },
              "onChainValue": {
                "type": "string",
                "example": "300000.00"
              },
              "profit": {
                "type": "string",
                "example": "+5.92%"
              },
              "profitRaw": {
                "type": "string",
                "example": "5.924183"
              }
            }
          },
          "reserveVault": {
            "type": "object",
            "properties": {
              "address": {
                "type": "string",
                "example": "0x7a6e684176d94863fd9e9e48673ed3a8f94265b9"
              },
              "currentValueUSD": {
                "type": "string",
                "example": "63554.51"
              },
              "onChainValue": {
                "type": "string",
                "example": "60000.00"
              },
              "profit": {
                "type": "string",
                "example": "+5.92%"
              },
              "profitRaw": {
                "type": "string",
                "example": "5.924183"
              }
            }
          },
          "total": {
            "type": "object",
            "properties": {
              "currentValueUSD": {
                "type": "string",
                "example": "3559052.56"
              },
              "onChainValue": {
                "type": "string",
                "example": "3360000.00"
              },
              "profit": {
                "type": "string",
                "example": "+5.92%"
              },
              "profitRaw": {
                "type": "string",
                "example": "5.924183"
              }
            }
          }
        }
      }
    },
    "responses": {
      "ErrorResponse": {
        "description": "Error response",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": {
                  "type": "boolean",
                  "example": false
                },
                "error": {
                  "type": "string",
                  "example": "Error message describing what went wrong"
                }
              }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "PrivateKey": {
        "type": "apiKey",
        "in": "header",
        "name": "X-Private-Key",
        "description": "Ethereum private key for signing transactions (passed in request body for POST endpoints)"
      }
    }
  },
  "externalDocs": {
    "description": "LiquidRoyalty Documentation",
    "url": "https://docs.liquidroyalty.io"
  }
}

